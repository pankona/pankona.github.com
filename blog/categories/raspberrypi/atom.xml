<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: RaspberryPi | make clean; make]]></title>
  <link href="http://pankona.github.io/blog/categories/raspberrypi/atom.xml" rel="self"/>
  <link href="http://pankona.github.io/"/>
  <updated>2014-07-15T22:13:56+09:00</updated>
  <id>http://pankona.github.io/</id>
  <author>
    <name><![CDATA[pankona]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[RaspberryPiで動画を配信しながら写真も撮る]]></title>
    <link href="http://pankona.github.io/blog/2014/06/10/raspi-photo-during-streaming/"/>
    <updated>2014-06-10T21:49:47+09:00</updated>
    <id>http://pankona.github.io/blog/2014/06/10/raspi-photo-during-streaming</id>
    <content type="html"><![CDATA[<p>Raspberry Pi＋カメラモジュールを使って、<br>
- 映像をWebページで配信しつつ。<br>
- いま写してる絵を保存する（写真を撮るみたいな）。写真を撮るボタンもWebページに備える。<br>
- 撮った写真はRaspberry Piにとりあえず保存しておいて、Webページ越しに確認できる。<br>
というのをやってみた。<br>
例によっていくつか躓いた点があるので、備忘録的に記しておく。</p>

<h3 id="raspistillでの静止画撮影とmjpg-streamerでの動画配信は同時に行えない？">raspistillでの静止画撮影とmjpg-streamerでの動画配信は同時に行えない？</h3>

<p>どうやらそのようである。最初は、<br>
「Webページ上にボタンを用意し、押されたら <code>raspistill</code> コマンドを発行する。」というやり方でやろうと思ったので当てが外れた感じ。<br>
mjpg-streamerで動画を配信する状態になっている状態でraspistillコマンドを実行すると、エラーが吐かれてしまってうまくいかない。<br>
mjpg-streamerにカメラデバイスを専有されてしまっているとか、そういう雰囲気でうまくいかないんだろうと予想。</p>

<h3 id="mjpg-streamerのsnapshot機能を使う">mjpg-streamerのsnapshot機能を使う</h3>

<p>ではどうするかと言うと、mjpg-streamerには静止画を撮影する機能があるので、これを使ってみた。<br>
<a href="https://code.google.com/p/mjpg-streamer/">mjpg-streamerのプロジェクトのページ</a>に少しサンプルがあって、例えば、mjpg-streamerを動作させている状態でもって、<br>
<code>http://[Raspberry PiのIPアドレス]:8080/?action=stream</code> というURLにアクセスすれば動画配信になり、<br>
<code>http://[Raspberry PiのIPアドレス]:8080/?action=snapshot</code> というURLにアクセスすれば、静止画の撮影になる。<br>
これらは、同時に行うことができる。つまり、これをうまく使えば動画を配信しながら静止画の撮影ができるのでは、と。</p>

<h3 id="wgetで画像を保存する">wgetで画像を保存する</h3>

<p>Webページ上にボタンを用意しておくところまでは同じで、ボタンが押されたら <code>raspistill</code> の代わりに、<code>wget</code> を発行する。<br>
例） <code>wget -O /tmp/picture.jpg http://[Raspberry PiのIPアドレス]:8080/?action=snapshot</code><br>
上記の例では、/tmp/picture.jpgという名前でmjpg-streamerが出力している動画のスナップショットが保存される。<br>
なので一応、動画配信しながら写真を撮る、という目的は達成できた。</p>

<p>できた、が、、、<br>
動画配信中の画像をそのまま静止画にするだけなので、例えば静止画の画質を動画のものより良くする、とか、画像サイズを変更する、アス比を変更する、とかできない。<br>
あくまで動画を一枚切り取っただけ、という感じ。まあ及第点か。。</p>

<h3 id="撮った画像を確認するためにrailsアプリを作った">撮った画像を確認するためにRailsアプリを作った</h3>

<p>Raspberry PiでRailsなんてどうなのか。でもちょっと作ってみた。<br>
目下作り途中だが。とりあえず動いてるのを見るのは楽しい。<br>
<a href="https://github.com/pankona/raspi_camera_server">https://github.com/pankona/raspi_camera_server</a></p>

<ul>
<li>あらかじめmjpg-streamerを起動した状態で、上記Railsアプリを動かす</li>
<li>Railsアプリに何かからアクセスすると、動画が配信されている状態を確認できる</li>
<li>動画をクリックすると、スナップショットが保存される。</li>
<li>保存されたスナップショットは、動画下部に小さく表示される。</li>
</ul>

<p>みたいなもの。テスト書いたりして改善していこう。。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Raspberry PiでRailsを動かしてみたときのこと]]></title>
    <link href="http://pankona.github.io/blog/2014/05/29/rails-on-raspi/"/>
    <updated>2014-05-29T21:02:35+09:00</updated>
    <id>http://pankona.github.io/blog/2014/05/29/rails-on-raspi</id>
    <content type="html"><![CDATA[<p>Raspberry PiにRailsを入れたときのこと。<br>
あまりすんなりとはいかなかったので、つまづいたところなんかをメモ。<br>
（ちなみにRaspberry Piで動いているOSはArch Linuxです。）</p>

<h2 id="第一の関門-railsのインストール">第一の関門 Railsのインストール</h2>

<p>Raspberry Piにsshで接続し、<code>gem install rails</code> とやるだけでRailsのインストールが始まる。<br>
簡単、、、なのだがこれがなかなか終わらない。しかしこれはただ単純に待てばいいので難しいことは何もない。<br>
終わるまで3時間程度。</p>

<p>sshで接続してる場合、ほっとくとタイムアウトしてしまうと思われる。<br>
その場合は、screen というので対策できる。nohup というのもある。<br>
とにかく長時間放置でタイムアウトしちゃってもいい（ログアウトしちゃってもいい）対策は必要。</p>

<h2 id="第二の関門-bundle-install">第二の関門 bundle install</h2>

<p>Railsアプリを動かす前準備で <code>bundle install</code> 。やると思います。<br>
これがまた死ぬほど時間かかる上に、インストール中に、</p>

<p>killed</p>

<p>とだけ出て終了しちゃう。当然だが bundle install は終わってない。<br>
こっちのが問題だった。</p>

<h3 id="killed-されちゃうのはメモリ不足のため">killed されちゃうのはメモリ不足のため</h3>

<p>bundle install で Killed になっちゃうのは、メモリ不足のための模様。<br>
これは、スワップ領域を設定してあげることで回避できた。<br>
スワップ領域設定の方法については、例によってArch LinuxのWikiを参照した。<br>
何でも載ってるね！ちなみ参照したページは<a href="https://wiki.archlinux.org/index.php/Swap_(%E6%97%A5%E6%9C%AC%E8%AA%9E)">これ - Swap （日本語） - ArchWiki</a>。</p>

<h3 id="killed-されなくなったけど、、、超時間かかる">killed されなくなったけど、、、超時間かかる</h3>

<p>killed されなくなったのはいいけど、Railsのインストールのときと同じく、やたら時間がかかる。。。<br>
9000秒くらいかかったので、実に3時間弱くらい。</p>

<p>なんで時間かかるかというと、まず、 <strong>therubyracer</strong> をインストールしようとしてるのが原因。<br>
これ自体はいれたかったのでいいんだけど、どうやらこいつを入れるのに伴って、 <strong>libv8</strong> というのが入る模様。<br>
そんでこれがどうやら <strong>ソースとってきてビルドしている</strong> ようなのである。Raspberry Piになんてことさせるんや。。。<br>
最近の割とパワーのあるPCなら10分程度で終わるらしいのだが。</p>

<h2 id="まとめると">まとめると</h2>

<p>RailsをRaspberry Piにインストールするためには、</p>

<ul>
<li>スワップ領域を拡大する（bundle install 中に killed されちゃうならば）</li>
<li>あとはひたすら待つ。トータルで6時間くらい待つ。</li>
</ul>

<p>ちなみにRailsの起動がまたすっとろい。webrickじゃなくてthinにするとちょっとだけ早くなる気がする、とか。</p>
]]></content>
  </entry>
  
</feed>
