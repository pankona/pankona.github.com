<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Posts &middot; make clean; make</title>

    <meta name="description" content="Demo site for a hugo theme">

    <meta name="generator" content="Hugo 0.32" />
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="Posts &middot; make clean; make">
    <meta name="twitter:description" content="Demo site for a hugo theme">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Posts &middot; make clean; make">
    <meta property="og:description" content="Demo site for a hugo theme">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">

    <link rel="stylesheet" href="https://pankona.github.io/css/all.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="make clean; make" href="https://pankona.github.io/index.xml" />
</head>
<body>


<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <hgroup>
            <h1 class="brand-title"><a href="https://pankona.github.io">make clean; make</a></h1>
            <h2 class="brand-tagline"> Demo site for a hugo theme </h2>
        </hgroup>

        <nav class="nav">
            <ul class="nav-list">
                
                <li class="nav-item">
                    <a class="pure-button" href="https://twitter.com/@gohan_pan_gohan"><i class="fa fa-twitter"></i> Twitter</a>
                </li>
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://github.com/pankona "><i class="fa fa-github-alt"></i> github</a>
                </li>
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://pankona.github.io/index.xml"><i class="fa fa-rss"></i> rss</a>
                </li>
            </ul>
        </nav>
    </div>
</div>


    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            
            <div class="posts">
                
                <h1 class="content-subhead">01 Jun 2017, 19:34</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2017/06/01/golangtokyo-6/" class="post-title">golang.tokyo#6@DeNA</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-golang" href="https://pankona.github.io/categories/golang">golang</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        

<p>2017.06.01 に DeNA さんにて、golang.tokyo #6 が行われました。</p>

<p><a href="https://golangtokyo.connpass.com/event/57168/">golang.tokyo #6 - connpass</a></p>

<p>開幕は DeNA の方のお話だったんですが、何やら DeNA では Go エンジニアを色々募集しているようです！
サーバーのみならず、色んなフィールドで Go を使っているとのことです。</p>

<p><img src="/images/golang.tokyo-6/3.jpg" alt="golang.tokyo-6" />
今日も大勢の方が参加されております。</p>

<p><img src="/images/golang.tokyo-6/4.jpg" alt="golang.tokyo-6" />
出遅れて私はありつけなかったですが、開幕前からお寿司が振る舞われていました！</p>

<p><img src="/images/golang.tokyo-6/5.jpg" alt="golang.tokyo-6" />
私はおビールいただきました。</p>

<h1 id="gopher-fest-2017-に参加した話-by-tenntenn-さん">Gopher Fest 2017 に参加した話 by tenntenn さん</h1>

<ul>
<li>mercari テックブログ にて既にまとめられている tenntenn さんの記事もあります。
(<a href="http://tech.mercari.com/entry/gopherfest2017_report">http://tech.mercari.com/entry/gopherfest2017_report</a>)</li>
</ul>

<p>今日は参加レポートをしてくれました。
主に 2017年8月上旬あたりにリリースされそうな Go 1.9 の話。</p>

<p>スライドはこちら。
<a href="https://www.slideshare.net/takuyaueda967/gopher-fest-2017">https://www.slideshare.net/takuyaueda967/gopher-fest-2017</a></p>

<p>以下、話の中で気になって点のピックアップ。</p>

<h2 id="言語仕様の拡張-alias-の追加">言語仕様の拡張 - Alias の追加</h2>

<p>型にエイリアスが張れるようになるとのこと。
以下のような書き方ができるようになる。</p>

<pre><code>type Applicant = http.Client
</code></pre>

<p>この場合、Applicant と http.Client は等価。</p>

<p>いつこれが役立つかというと、型をリネームするようなリファクタリングを行うとき。
以下の手法だとうまく行かない。</p>

<p>(パターン1) 新しい型を作って順次移行する場合</p>

<pre><code>type Applicant Client
</code></pre>

<ul>
<li>Applicant は Client に生えていたメソッドを引き継げない。</li>
<li>キャストは可能。</li>
</ul>

<p>(パターン2) 埋め込みを使う場合</p>

<pre><code>type Applicant struct { Client }
</code></pre>

<ul>
<li>Applicant は Client に生えていたメソッドを引き継げる</li>
<li>しかしキャストはできない</li>
</ul>

<p>型エイリアスを用いると、</p>

<ul>
<li>両者等価なのでキャスト不要で交換可能</li>
<li>メソッドもそのまま使える、が、エイリアス側に生やすことはできない</li>
</ul>

<h4 id="参考">参考</h4>

<ul>
<li>安全にリファクタリングするには？<br />
<a href="https://talks.golang.org/2016/refactor.article">codebase refactoring (with help from Go) by rsc</a></li>
</ul>

<h2 id="ライブラリへの変更">ライブラリへの変更</h2>

<h3 id="ビット演算ライブラリ">ビット演算ライブラリ</h3>

<p><a href="http://tip.golang.org/pkg/math/bits/">http://tip.golang.org/pkg/math/bits/</a>
各種ビット演算用の某がそろっております。</p>

<h3 id="sync-map">sync.Map</h3>

<p>スレッドセーフなマップが追加に。
しかも make しないで 0 値のまま使えるらしく便利。</p>

<h3 id="os-exec-環境変数をコードで上書きできるように">os.Exec 環境変数をコードで上書きできるように</h3>

<p>環境変数で指定されている値をコード上で上書きできなかった。
Go 1.9 からは後勝ち。より直感的な動作になる。コードで上書きできるように！</p>

<p>などなど。
スライドには出ていませんでしたが、個人的には mips32 向けの softfloat サポートがどうなったか気になります。Go 1.9 でサポートされるんだったような。</p>

<p>次は DeNA の方。</p>

<h1 id="初めて-golang-で大規模-microservices-を作り得た教訓-by-yuichi-murata">初めて Golang で大規模 Microservices を作り得た教訓 by Yuichi MURATA</h1>

<p>DeNA の方です。
AndApp を作ったときに得られた教訓の話。</p>

<p>Gin と Echo をさまよった話でさまざま苦労なさったそうな。
失敗談をメインに話してくださったので、そういうのは割と貴重と思います。</p>

<p>スライドはこちら。
<a href="https://www.slideshare.net/yuichi1004/golangtokyo-6-in-japanese">https://www.slideshare.net/yuichi1004/golangtokyo-6-in-japanese</a></p>

<h2 id="教訓1-go-でフレームワークに拘ることはない">教訓1. Go でフレームワークに拘ることはない。</h2>

<ul>
<li>Gin を使って開発を始める。</li>
<li>ちょっと困ったことがあって、一部で別のフレームワーク (Echo) を使い始める</li>
<li>両対応しつつ、また Echo 自身の開発がホットなせいで設計がどんどん変わってしまう</li>
</ul>

<p>というようなことで、聞いているだけでしんどい気持ちでいっぱいでしたが、
結論としては、フレームワークに頼らずに net/http 使っとくのが一番や、という話でした。
ツールに振り回されるとツライですね。納得。</p>

<h2 id="教訓2-interface-を尊重する-エラーの型の話">教訓2. Interface を尊重する - エラーの型の話</h2>

<p>独自エラー型と error インターフェースを混在させると起こり得る罠。
独自 error は nil 扱いされない問題。
素直に error インターフェースの利用に統一するべきだという結論。</p>

<p>エラーの種類によって分岐したいとき等、結構ひとによってやり方がまちまちだという気がするので、
なにがしかデファクトスタンダードなやり方が示されていると良い気がしますね。</p>

<p>ちなみに、自分が書くときの「エラーで分岐」については、
deeeet さんの <a href="http://deeeet.com/writing/2016/04/25/go-pkg-errors/">Golangのエラー処理とpkg/errors</a> で記載されているやり方に従っている。</p>

<h2 id="regex-compile-reflection-の遅さ">regex compile / reflection の遅さ</h2>

<p>JSON Schema でバリデーション。
OSS として扱った二種の速度の話。</p>

<ul>
<li>gojsonschema

<ul>
<li>validation のたびに parse &amp; compile するので遅い</li>
</ul></li>
<li>go-jsval

<ul>
<li>こちらは速い</li>
</ul></li>
</ul>

<p>regex / reflection 等の処理は遅いので、使うときは意識しないといけない</p>

<h2 id="結論">結論</h2>

<ul>
<li>Go の哲学。シンプルなアプローチを。</li>
<li>「コンパイルする言語だから速い」と過信せず、パフォーマンスに気を配ろう。</li>
</ul>

<p>以下、LT。</p>

<h1 id="ゲーム開発で必要な-by-konboi">ゲーム開発で必要な by @konboi</h1>

<p>カヤックの方。
<a href="https://speakerdeck.com/konboi/gemukai-fa-nihaqian-kasenai-arewosiyututojian-ru">スライドはこちら</a></p>

<h2 id="csv-の話">CSV の話</h2>

<p>データの形によっては非常に見にくいCSV。
いい感じに整形してくれるツールを作った！
<a href="github.com/Konboi/csviewer">csvviewer</a></p>

<p>スターしておきました。</p>

<h1 id="go-code-review-comments-を読もう-by-knsh14">Go code Review Comments を読もう by knsh14</h1>

<p>KLabの方。スライドはこちら。
<a href="https://speakerdeck.com/knsh14/go-code-review-comment-wofan-yi-sitahua">https://speakerdeck.com/knsh14/go-code-review-comment-wofan-yi-sitahua</a></p>

<p>こういう記事があって、Effective Go 簡易版というか、Go のお作法初級編みたく書かれている。
<a href="https://github.com/golang/go/wiki/CodeReviewComments">Go Code review comments</a></p>

<p>それを日本語訳した！
* <a href="http://qiita.com/knsh14/items/8b73b31822c109d4c497">Qiita の記事はこちら</a></p>

<p>初学者のみならず、ある程度経験がある人でも読んで損はないと思いました。
認識を改めるというかね。ちなみに社内勉強会で使わせていただきました、感謝！</p>

<h1 id="scala-から-go-にきた話-by-james-さん">Scala から Go にきた話 by James さん</h1>

<p>エウレカの方。
スライドは発見できませんでした…。</p>

<p>Scala が好きということは分かりました。
悲しいアリクイかわいい。</p>

<h1 id="crypto-in-go-by-suzuki-kengo-さん">Crypto in Go by suzuki kengo さん</h1>

<p>マネーフォワードの方。</p>

<p>資料はこちら。アライさんですね。
<a href="https://paper.dropbox.com/doc/Crypto-in-Go-cWLX9XxHQm6bAPqrZYkjt">https://paper.dropbox.com/doc/Crypto-in-Go-cWLX9XxHQm6bAPqrZYkjt</a></p>

<p>難しい。</p>

<h1 id="まとめ">まとめ</h1>

<p>ということで今回も参加させていただきました、ありがとうございました。
失敗談というかアンチパターンというか、そういう話が聞けたのは大きな収穫でした。</p>

<p>2017.06.15 現在、既に次の golang.tokyo が企画されています。
<a href="https://techplay.jp/event/624712">golang.tokyo #7</a>
気になる方は要チェックです！</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">01 Mar 2017, 19:31</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2017/03/01/golangtokyo-4/" class="post-title">golang.tokyo#4@eureka</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-golang" href="https://pankona.github.io/categories/golang">golang</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        

<p>2017.03.01 に eureka さんにて、golang.tokyo #4 が行われました。</p>

<p><a href="https://golangtokyo.connpass.com/event/50714/">golang.tokyo #4 - connpass</a></p>

<p>今回もまた大盛況で一般参加枠は倍率3倍くらいの抽選となっていましたが、
たまたまブログ枠が空いているところに遭遇してしまったため、またしてもブログ枠として
参加させていただきました。内容をレポートしていきます。</p>

<p>発表内容の詳細は、実際発表に用いられたスライド (上記 connpass のページから辿れます) を参照いただくのが一番良いと思いますので、
本記事ではその他、イベントの雰囲気や私の感想を主にお伝えしていくような体になります。
それではいきます。今回のテーマは <strong>「concurrency」</strong> 。</p>

<hr />

<h1 id="concurrency-for-distributed-web-crawlers-by-puhitaku-さん">Concurrency for distributed Web crawlers by puhitaku さん</h1>

<p><a class="embedly-card" data-card-key="ee29ed4b275e459483a608ca67084559" data-card-controls="0" href="https://speakerdeck.com/puhitaku/concurrency-for-distributed-web-crawlers">Concurrency for distributed Web crawlers</a>
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script></p>

<p>(↑のカードをクリックでスライドに飛びます。)</p>

<h2 id="appstore-と-google-play-をクロールして欲しい情報を収集するやつ">AppStore と Google Play をクロールして欲しい情報を収集するやつ</h2>

<ul>
<li><p>クロール対象はシングルドメイン。だが対象となるアプリが多い (100k以上) 。</p>

<ul>
<li>同一IPからあんまりひどいことするとバンされたりする&hellip;。</li>
<li>とはいえあんまりちんたらやってるわけにもいかない。24時間以内にクロールし終わる必要がある。</li>
</ul></li>

<li><p>Commander と Crawler</p>

<ul>
<li>AWS EC2 Container Service を使っている。</li>
<li>一日30弱くらいのインスタンスを立ち上げて並列でクローリングする。</li>
</ul></li>

<li><p>1 アプリあたりのクロール時間が見積もれないと困る。</p>

<ul>
<li>1 アプリあたりのクロール速度は割とまちまち。終わるの待ってたらクロール量が安定しない。</li>
<li>一個あたりのクロールを goroutine で行う。</li>
<li>規定時間を設ける。規定時間より超過した場合、終わってなくても次のタスクをスタートさせる。</li>
<li>という戦略で、時間あたりのクロール数を見積もれるという寸法。</li>
</ul></li>

<li><p>落とし穴シリーズ</p>

<ul>
<li>TCPコネクションを使い果たす問題。並列に行われるクロールの数が多すぎると TCP コネクションを使い果たしてしまう…。</li>
<li>この問題は、make(chan int, 100) みたくして、Channel が保持する値の数を制限することで対応。</li>
</ul></li>
</ul>

<hr />

<h1 id="goのスケジューラー実装とハマりポイント-by-niconegoto-さん">Goのスケジューラー実装とハマりポイント by niconegoto さん</h1>

<p><a class="embedly-card" data-card-key="ee29ed4b275e459483a608ca67084559" data-card-controls="0" data-card-type="article-full" href="https://talks.godoc.org/github.com/niconegoto/talks/concurrency.slide#1">Goのスケジューラー実装とハマりポイント</a>
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script></p>

<p>Goroutine の内部実装について。</p>

<h2 id="goroutine-の実装デザイン">Goroutine の実装デザイン</h2>

<ul>
<li>runtime を読む。</li>

<li><p><a href="https://golang.org/pkg/runtime">https://golang.org/pkg/runtime</a></p></li>

<li><p>M、G、P という文字が頻繁に出てくる。それらの意味は、</p>

<ul>
<li>M &hellip; Machine</li>
<li>G &hellip; Goroutine</li>
<li>P &hellip; Processor</li>
</ul></li>
</ul>

<h2 id="スケジューラーのハマりどころ">スケジューラーのハマりどころ</h2>

<ul>
<li>C 言語の pthread なんかと同じで、goroutine もコンテキストスイッチを考慮する必要がある。</li>
<li><a href="https://morsmachine.dk/go-scheduler">Morsing&rsquo;s Blog</a> に詳しいこと書いてある。</li>
</ul>

<h1 id="ridge-a-framework-like-gae-go-on-aws-by-fujiwara-さん">Ridge a framework like GAE/Go on AWS by fujiwara さん</h1>

<p><a class="embedly-card" data-card-key="ee29ed4b275e459483a608ca67084559" data-card-controls="0" href="https://speakerdeck.com/fujiwara3/go-on-aws">Ridge - A framework like GAE/Go on AWS</a>
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script></p>

<p>Go で書いた HTTP Server を AWS Lambda で動かす…！</p>

<h2 id="ridge-の紹介">Ridge の紹介</h2>

<ul>
<li><a href="https://github.com/fujiwara/ridge">Ridge</a></li>
<li>実質、GAE/Go みたいなことを AWS Lambda で実現できる</li>
<li>裏で goroutine を延々動かしておくみたいなことはできない。Lambda はレスポンス返し終わると寝てしまう。

<ul>
<li>次のリクエストが来たら起きて続きの処理が行われていく</li>
</ul></li>

<li><p>頻繁にアクセスがなく、レイテンシ要求がシビアでないようなものに向く</p>

<ul>
<li>サービスが終了したゲームの告知 API とか。POST を受けて JSON を返す、という処理を EC2 使わないで行う。</li>
</ul></li>

<li><p>EC2 使わず、それでいてリクエスト数が多ければスケールする、ということで用途が合えば非常にリーズナブルにできる印象。</p></li>
</ul>

<hr />

<h1 id="ライブコーディング-by-kaneshin-さん">ライブコーディング by kaneshin さん</h1>

<p><img src="/images/golang.tokyo-4/1.jpg" alt="golang.tokyo-4" />
写真1. ライブコーディング直前の kaneshin さん</p>

<ul>
<li>tail コマンドを作る&hellip;!</li>
<li><a href="https://gist.github.com/kaneshin/a398720b8e20722a83bc6903e4017435">完成したものはこちら</a></li>
</ul>

<h2 id="ポイント-と思ったところ">ポイント (と思ったところ)</h2>

<ul>
<li>kaneshin さんは vim + vim-go プラグインを使って Go を書いている模様。</li>
<li>channel をバッファのように扱っている。</li>
<li>入力を待ち受ける goroutine と、出力を担当する goroutine とで 2 並列。
今回のテーマにあった良い題材であると感じた。</li>
</ul>

<hr />

<h1 id="嫁に怒られずに-go-を書く技術-by-teitei-tk">嫁に怒られずに Go を書く技術 by teitei_tk</h1>

<p><a class="embedly-card" data-card-key="ee29ed4b275e459483a608ca67084559" data-card-controls="0" href="https://speakerdeck.com/teitei/jia-ninu-rarezunigowoshu-kuji-shu">嫁に怒られずにGoを書く技術</a>
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script></p>

<p>「嫁のため」という免罪符を得て開発していくスタイル</p>

<ul>
<li>LINE に天気予報だったりを投稿する。</li>
<li>つまり生活に役立つというか家内に益があれば良いということ。</li>
<li>夫婦円満を願ってやまない。</li>
</ul>

<hr />

<h1 id="gogland-by-sergey-ignatov-さん">Gogland by Sergey Ignatov さん</h1>

<p><img src="/images/golang.tokyo-4/2.jpg" alt="golang.tokyo-4" />
写真2. Gogland の開発者 Sergey Ignatov さん</p>

<p>JetBrains から Sergey Ignatov さんが来てくれて、Gogland の紹介をしてくれたぞ！</p>

<ul>
<li>function の定義に飛んで実装を確認する必要はなく、小窓で出せるような機能がある。便利そう。</li>
<li>引数のサジェストが賢い。ファジーサーチ的に動きつつ、型が合わないものはサジェストされない、等。</li>
<li>保存時に go fmt、 go import する機能も最近対応された。</li>
<li>2017年3月現在は EAP 版だが、年末くらいには EAP が取れて正式版になるような予定らしい。</li>
<li>意見・要望があったら <a href="https://youtrack.jetbrains.com/issues/GO">issue tracker</a> へ！</li>
</ul>

<hr />

<p>ざっくりですが、かいつまんで golang.tokyo 4 回目の様子を紹介いたしました。
休憩時間にはビールも振る舞われたりして、無料でいいんですかという気持ちになります。
いつもありがとうございます。</p>

<p>次回もまた 4 月くらいに実施されるようなので、都合が合えば参加させていただこうかと思います。</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">14 Dec 2016, 11:12</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2016/12/14/jp-input-on-gnome-app/" class="post-title">GNOMEアプリ上で日本語入力できなくなったときの対処メモ</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-ArchLinux" href="https://pankona.github.io/categories/archlinux">ArchLinux</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        

<p>何が原因かハッキリしていないが、Linux をアップデート (パッケージの更新という意味) したときに
日本語が入力できなくなることがあった。</p>

<p>起きたこととしては、
* firefox 上では日本語入力可能 (direct input と日本語のトグル可能) 。
* Slack、chromium の上では日本語入力できない (direct input のみ可能) 。</p>

<p>環境は、
* Manjaro Linux (2016年12月あたり)
* fcitx を使用
* 日本語入力は mozc</p>

<p>方々ググって対処法を見つけたのでメモ。</p>

<h2 id="dconf-editor-で設定を確認し-必要に応じて修正する">dconf Editor で設定を確認し、必要に応じて修正する</h2>

<p>dconf Editor を開き、以下の設定を確認する。
* <code>/org/gnome/settings-daemon/plugins/xsettings/overrides</code> を参照する
* 値に <code>{'Gtk/IMModule': &lt;'fcitx'&gt;}</code> が入っているかどうか</p>

<p>コマンドラインから確認する場合は以下のように入力する。</p>

<pre><code>$ gsettings get org.gnome.settings-daemon.plugins.xsettings overrides
# (期待される出力) {'Gtk/IMModule': &lt;'fcitx'&gt;}
</code></pre>

<p>入ってなかったら、上記の値をコピペして設定する。
コマンドラインから設定する場合は以下のように入力する。</p>

<pre><code>$ gsettings set org.gnome.settings-daemon.plugins.xsettings overrides &quot;{'Gtk/IMModule':&lt;'fcitx'&gt;}&quot;
</code></pre>

<p>当方の環境ではこれで日本語入力ができる状態になった。</p>

<h2 id="参考サイト">参考サイト</h2>

<ul>
<li><a href="https://wiki.archlinuxjp.org/index.php/Fcitx#Gnome-Shell">Fcitx - ArchWiki (日本語版)</a>

<ul>
<li>「Ctrl+Space が GTK のプログラムで機能しない」の項を参照。</li>
</ul></li>
</ul>

                    </div>
                </section>
                
                <h1 class="content-subhead">12 Dec 2016, 19:24</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2016/12/12/golangtokyo-2/" class="post-title">golang.tokyo#2@はてな</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-golang" href="https://pankona.github.io/categories/golang">golang</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        

<p>2016.12.12 に表参道のはてなさんにて、golang.tokyo #2 が行われました。</p>

<p><a href="https://golangtokyo.connpass.com/event/44807/">golang.tokyo #2 - connpass</a></p>

<p>今回もまたブログ枠にて参加させていただきましたので、
その内容をレポートしていきます。</p>

<p>発表内容の詳細はスライド (上記 connpass のページから辿れます) を参照いただくのが一番良いと思います。
本記事ではその他、イベントの雰囲気や私の感想を主にお伝えできればいいかなと思っています。
それでは行きます。</p>

<hr />

<p>今回の golang.tokyo は 2 回目の開催。
今後も色々目論まれているようです。楽しみ。</p>

<p><img src="/images/golang.tokyo-2/02.jpg" alt="golang.tokyo-2" />
図1. golang.tokyo について</p>

<p>golang.tokyo 2 回目のテーマは <strong>「テスト」</strong> について。</p>

<hr />

<h1 id="テストしやすいgoコードのデザイン-by-deeeet-さん">テストしやすいGoコードのデザイン by deeeet さん</h1>

<p><a class="embedly-card" data-card-key="ee29ed4b275e459483a608ca67084559" data-card-controls="0" data-card-type="article-full" href="https://talks.godoc.org/github.com/tcnksm/talks/2016/12/golang-tokyo/golang-tokyo.slide#1">テストしやすいGoコードのデザイン</a>
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>
(↑のカードをクリックでスライドに飛びます。)</p>

<p><img src="/images/golang.tokyo-2/07.jpg" alt="golang.tokyo-2" />
図2. 発表中の deeeet さん。</p>

<p>以下、印象に残ったところを抜粋。</p>

<h2 id="deeeet-さんはテストフレームワークを使わない派">deeeet さんはテストフレームワークを使わない派</h2>

<p>テストのフレームワークは使わず、testing パッケージだけで十分であろうとの意見。
これは、フレームワークは「ミニDSL」であって、導入するひとはまだしも、
あとからプロジェクトに入ってくる人は学習する部分が増えてしんどくなってしまう、という一面があるからとのこと。
納得。</p>

<h2 id="テストしやすいコードとは">テストしやすいコードとは</h2>

<p><strong>「Table Driven Test」</strong> がおすすめ。
* 入出力が理解しやすい
* テストケース追加が容易
* 「Table Driven Test に落とし込めるコード」は入出力が明確でテストしやすいコード</p>

<h2 id="テストしにくくなる要素とその対策">テストしにくくなる要素とその対策</h2>

<p>テストしにくくなるというのは「Table Driven Test」がやりにくくなる状況を指す。
→ 入力以外の要素が出力影響を及ぼしてしまう状況。</p>

<ul>
<li>グローバル変数 (暗黙の入力)

<ul>
<li>なるべく関数の引数に入れるようにしてテストしやすくする</li>
<li>もしくは「デフォルトの値」として <strong>のみ</strong> 使う</li>
<li>変わらないかもしれない定数っぽい値もなるべく設定可能にする</li>
<li>環境変数もグローバル変数と同じ</li>
</ul></li>
<li>ユーザーの入力 (コマンドを入力→期待通りに動いたか、のテスト)

<ul>
<li>入力の受取に os.Stdin を暗黙的に使わず io.Reader を使い、テスト時に仮想的な入力を行えるようにする。</li>
<li>入力に対する出力で、Table Driven にすることができるようになる。</li>
</ul></li>
<li>ファイル出力 (ファイル出力された内容が正しいかどうか、のテスト)

<ul>
<li>実際に書いたあとに開き直して中身を確認するのでもテストは可能だが、大量にやろうと思うと遅くなってしまう。</li>
<li>入力のときと考え方は同じで、io.Writer を出力先とし、テスト時はオンメモリのバッファに出力できるようにする。</li>
<li>バッファに出力された内容とその期待結果で、Table Driven することができるようになる。</li>
</ul></li>
</ul>

<h1 id="macherelにおけるgoのエコシステムとかテストとか-by-songmu-さん">MacherelにおけるGoのエコシステムとかテストとか by Songmu さん</h1>

<p><a class="embedly-card" data-card-key="ee29ed4b275e459483a608ca67084559" data-card-controls="0" data-card-image="https://mackerel.io/files/images/brand-assets/screenshot-service.png" data-card-type="article-full" href="http://songmu.github.io/slides/golangtokyo-2/">MackerelにおけるGoのエコシステムとかテストとか</a>
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>
(↑のカードをクリックでスライドに飛びます。)</p>

<p><img src="/images/golang.tokyo-2/09.jpg" alt="golang.tokyo-2" />
図3. 発表中の songmu さん</p>

<h2 id="mackerel-のエコシステム周りの話">Mackerel のエコシステム周りの話</h2>

<ul>
<li>ソースをオープンにしてパッチ受け入れるようにした。

<ul>
<li>ホスト先は GitHub。contribute してもらいやすい。</li>
<li>pull request に対するレビュー体制、CI が必要。</li>
<li>Travis CI、Circle CI を使っている。CI の内容は以下のようなもの。

<ul>
<li>go vet、 golint go test</li>
<li>coverage 計測</li>
<li>cross build 可能か</li>
</ul></li>
</ul></li>
<li>ちなみに Changelog はプルリクエストの情報から自動生成している。</li>
</ul>

<h2 id="ミドルウェアのテスト">ミドルウェアのテスト</h2>

<ul>
<li>実際にテスト時に実行する

<ul>
<li>DB ならばモックせずに実際に DB を立ててデータを入れて確認をする、のような。</li>
<li>モックや interface でのテストでは気づけない部分もあるので、実際にやってテストする。</li>
</ul></li>
</ul>

<hr />

<h1 id="休憩">休憩</h1>

<p>deeeet さん、songmu さんの発表のあと、いったん休憩に。
休憩ではピザとビールが振る舞われまして、はてなさんにスポンサーしていただいたとのこと。
ありがたくいただきました。</p>

<p><img src="/images/golang.tokyo-2/11_rotated.jpg" alt="golang.tokyo-2" />
図4. ピザとビールをはてなさんから振る舞っていただく。</p>

<p><img src="/images/golang.tokyo-2/12.jpg" alt="golang.tokyo-2" />
図5. 会場遠景。芝生です。</p>

<p><img src="/images/golang.tokyo-2/13.jpg" alt="golang.tokyo-2" />
図6. deeeet さんにむらがる Gophers (私もこのあとむらがりました) 。</p>

<p>勉強会の真ん中にこういう親睦会的なノリの時間が設けられるのは珍しいかな？
なんだか新鮮でした。参加者の方とも少しだけお話できたりしました。
勉強会終わってからの親睦会だと参加できないケースが多い私のようなものにとっては、会の真ん中にこういうのやってもらうのもいいかもしれない。</p>

<hr />

<h1 id="ここから-lt-コーナー">ここから LT コーナー</h1>

<p>ピザとビールで温まってきたところで LT 開始。</p>

<h2 id="timakin-さん">timakin さん</h2>

<p><a class="embedly-card" data-card-key="ee29ed4b275e459483a608ca67084559" data-card-controls="0" href="https://speakerdeck.com/timakin/plain-db-import-with-go">Plain db import with Go</a>
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script></p>

<ul>
<li><a href="https://github.com/timakin/gopli">timakin/gopli</a>

<ul>
<li>開発環境を本番環境に近づけるやつ。本番データをローカルに簡単にもってくる。</li>
</ul></li>
</ul>

<h2 id="osamingo-さん">osamingo さん</h2>

<p><a class="embedly-card" data-card-key="ee29ed4b275e459483a608ca67084559" data-card-controls="0" href="https://speakerdeck.com/osamingo/go-deshi-meru-json-rpc-ru-men">Go で始める JSON-RPC 入門</a>
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script></p>

<ul>
<li>JSON-RPC！</li>
</ul>

<h2 id="kazuhiratogo-さん">KazuhiraTogo さん</h2>

<p><a class="embedly-card" data-card-key="ee29ed4b275e459483a608ca67084559" data-card-controls="0" href="https://speakerdeck.com/ktogo/continuous-deployment-with-go-on-aws-ecs">Continuous Deployment with Go on AWS ECS</a>
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script></p>

<ul>
<li>デプロイをとことん自動化した話。</li>
<li>本番とローカルで同じ環境を → Docker を使う。</li>
<li>Circle CI 上の docker は Ubuntu。本番は Alpine。環境の違いが問題に。 → Docker on Docker にして解決した。</li>
</ul>

<hr />

<p>以上の内容でした。せめて雰囲気くらい伝わればいいですが。
いずれの発表もとても内容が濃くて、勉強になりっぱなしでした。感謝。
ひとまず Table Driven Test ですかね。取り入れてなかったのでやってみようか等と思い。</p>

<p>感謝といえば、運営サイドのこと。
ほぼトラブルなしでスムーズに進んだのは、十分に準備してくれていたということだと思います。
だいたいマイクの電池が切れたりスライドがうまく映らなかったり、そういうの対策しようがなくてしょうがないところもあるんですが、
今回に関してはそういうのほぼほぼなくて、というかマイクの音量とか超ちょうど良くて、本当に細かい配慮を感じました。多謝。
他にも、アンケートを集めて次回のネタにしたりしていて (今回のテーマも、前回のアンケートでテストに関することを聞きたいという要望が多かったから、という理由で選んだとのこと)、golang.tokyo 運営すげーなという印象です。すげーな！</p>

<p>次回もまた来年に予定されているようです。楽しみにしています！</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">14 Nov 2016, 20:14</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://pankona.github.io/blog/2016/11/14/usb-wifi-dongle/" class="post-title">Linux で 無線LAN の USB ドングルを使う</a>

                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-ArchLinux" href="https://pankona.github.io/categories/archlinux">ArchLinux</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        

<p>Linux と銘打っておりますが、Manjro で試しています。
本記事は Linux で 無線LAN のドングルを使えるようにした備忘録です。</p>

<h2 id="使ったドングル二種">使ったドングル二種</h2>

<p>訳あって二種類のドングルを使いました。いずれも I-O DATA 製。</p>

<ul>
<li>WN-AC433UM</li>
<li>WN-G150UMK</li>
</ul>

<h2 id="wn-ac433um-編">WN-AC433UM 編</h2>

<p>とりあえずぶっ挿してみたところ、無線LAN デバイスとしては認識されなかった。
つまりデフォルトの Manjro には WN-AC433UM のドライバが入っていなかったということ。
ドライバを入れていく。</p>

<h3 id="wn-ac433um-は-rtl8192eu-というドライバで動いた">WN-AC433UM は rtl8192eu というドライバで動いた</h3>

<p>rtl8192eu というドライバは <code>yaourt rtl8192eu</code> で一応インストールされるのであるが、
それだけだと WN-AC433UM は認識されなかった。</p>

<p>WN-AC433UM は、idVendor が 04BB、idProduct が 0959 であるが、
<code>yaourt rtl8192eu</code> でインストールされるドライバではこれを認識するようになっていない。
(注: 2016.11.09 時点)</p>

<p>なので、上記 idVendor、idProduct 値を認識するようにソースコードを書き換えた上で、
ビルド・インストールする必要がある。ソースコードは以下から入手できる。</p>

<p><a href="https://github.com/Mange/rtl8192eu-linux-driver">Mange/rtl8192eu-linux-driver - GitHub</a>
なお、リビジョンは <code>f016814</code> を使った。</p>

<p>os_dep/linux/usb_intf.c に、以下のように追記する。
(注: 妥当か不明だがとりあえず以下の書き換えでうまくいった)</p>

<pre><code>diff --git a/os_dep/linux/usb_intf.c b/os_dep/linux/usb_intf.c
index 5a62f24..7138a26 100644
--- a/os_dep/linux/usb_intf.c
+++ b/os_dep/linux/usb_intf.c
@@ -220,6 +220,8 @@ static struct usb_device_id rtw_usb_id_tbl[] ={
        {USB_DEVICE(0x2357, 0x0109),.driver_info = RTL8192E}, /* TP-Link - Cameo */
        /*=== PLANEX ===========*/
        {USB_DEVICE(0x2019, 0xab33),.driver_info = RTL8192E}, /* PLANEX - GW-300S Katana */
+       /*=== I-O DATA ===========*/
+       {USB_DEVICE(0x04bb, 0x0959),.driver_info = RTL8192E}, /* I-O DATA */
 #endif
 
 #ifdef CONFIG_RTL8723B
</code></pre>

<p>ビルドし、インストールする。</p>

<pre><code>$ cd rtl8192eu-linux-driver
$ make
$ sudo make install
</code></pre>

<p>再起動すると、無線LAN ドングルを NIC として認識するようになった。</p>

<h2 id="wn-g150umk-編">WN-G150UMK 編</h2>

<p>上記 WN-AC433UM を認識させるにあたって散々ドライバをインストールしたせいなのであろうが、
こちらは挿しただけで認識されてしまった。</p>

<h3 id="wn-g150umk-は-rtl8192cu-というドライバで動いている模様">WN-G150UMK は rtl8192cu というドライバで動いている模様</h3>

<p>もしかしたらドライバをインストールする必要があるかもしれないのでメモしておくと、
WN-G150UMK は rtl8192cu というドライバで動いている模様。<code>lshw</code> コマンドで確認した。</p>

<h2 id="ちなみに-wn-ac433um-は-5-ghz-にしか対応していない">ちなみに、WN-AC433UM は 5 GHz にしか対応していない</h2>

<p>WN-AC433UM は 5GHz 帯「のみ」に対応しており、
つまり 2.4 GHz 帯を用いる無線機器とは接続ができない。スキャンしても発見すらしてくれない。
2.4 GHz っていうのはたとえば Android 5.0 以前の Android 端末のテザリングであったり、
ちょっと古めのルーターだったりが該当する。</p>

<p>完全に自分の見落としであるのだが、我が家の装備はことごとく 2.4 GHz 帯を扱うモノばかりだったので、
つまりせっかく頑張って WN-AC433UM を Linux に認識させたのであるが、日の目を見なかったのである…。
悲しい。そんなわけで WN-G150UMK を書い直したが、こちらは快調に動いてます。ナイス。</p>

<h2 id="参考リンク">参考リンク</h2>

<ul>
<li><a href="http://www.iodata.jp/product/network/adp/wn-ac433um/">WN-AC433UMシリーズ - I-O DATA</a></li>
<li><a href="http://www.iodata.jp/lib/product/w/4078.htm">WN-G150UMK - I-O DATA</a></li>
</ul>

                    </div>
                </section>
                
            </div>
            
<div class="pagination">
  <nav role="pagination" class="post-list-pagination">
      
    <span class="post-list-pagination-item post-list-pagination-item-current">Page 1 of 7</span>
    
      <a href="/posts/page/2/" class="post-list-pagination-item pure-button post-list-pagination-item-next">
        Older&nbsp;<i class="fa fa-angle-double-right"></i>
      </a>
    
  </nav>
</div>


            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li>Powered by <a class="hugo" href="https://gohugo.io/" target="_blank">hugo</a></li>
        </ul>
    </div>
</div>
<script src="https://pankona.github.io/js/all.min.js"></script>

        </div>
    </div>
</div>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', '', 'auto');
ga('send', 'pageview');

</script>

</body>
</html>
