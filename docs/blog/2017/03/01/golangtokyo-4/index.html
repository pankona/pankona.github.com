<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>golang.tokyo#4@eureka &middot; make clean; make</title>

    <meta name="description" content="">

    <meta name="generator" content="Hugo 0.32" />
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="golang.tokyo#4@eureka &middot; make clean; make">
    <meta name="twitter:description" content="">

    <meta property="og:type" content="article">
    <meta property="og:title" content="golang.tokyo#4@eureka &middot; make clean; make">
    <meta property="og:description" content="">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">

    <link rel="stylesheet" href="https://pankona.github.io/css/all.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="make clean; make" href="https://pankona.github.io/atom.xml" />
</head>
<body>


<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <hgroup>
            <h1 class="brand-title"><a href="https://pankona.github.io">make clean; make</a></h1>
            <h2 class="brand-tagline"></h2>
        </hgroup>

        <nav class="nav">
            <ul class="nav-list">
                
                <li class="nav-item">
                    <a class="pure-button" href="https://twitter.com/@gohan_pan_gohan"><i class="fa fa-twitter"></i> Twitter</a>
                </li>
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://github.com/pankona "><i class="fa fa-github-alt"></i> github</a>
                </li>
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://pankona.github.io/atom.xml"><i class="fa fa-rss"></i> rss</a>
                </li>
            </ul>
        </nav>
    </div>
</div>


    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            
            <div class="posts">
                <h1 class="content-subhead">01 Mar 2017, 19:31</h1>
                <section class="post">
                    <header class="post-header">
                        <a href="https://pankona.github.io/blog/2017/03/01/golangtokyo-4/" class="post-title">golang.tokyo#4@eureka</a>
                        <p class="post-meta">
                            
                            
                                under 
                                
                                <a class="post-category post-category-golang" href="https://pankona.github.io/categories/golang">golang</a>
                            
                        </p>
                    </header>
                    <div class="post-description">
                        

<p>2017.03.01 に eureka さんにて、golang.tokyo #4 が行われました。</p>

<p><a href="https://golangtokyo.connpass.com/event/50714/">golang.tokyo #4 - connpass</a></p>

<p>今回もまた大盛況で一般参加枠は倍率3倍くらいの抽選となっていましたが、<br />
たまたまブログ枠が空いているところに遭遇してしまったため、またしてもブログ枠として<br />
参加させていただきました。内容をレポートしていきます。</p>

<p>発表内容の詳細は、実際発表に用いられたスライド (上記 connpass のページから辿れます) を参照いただくのが一番良いと思いますので、<br />
本記事ではその他、イベントの雰囲気や私の感想を主にお伝えしていくような体になります。<br />
それではいきます。今回のテーマは <strong>「concurrency」</strong> 。</p>

<hr />

<h1 id="concurrency-for-distributed-web-crawlers-by-puhitaku-さん">Concurrency for distributed Web crawlers by puhitaku さん</h1>

<p><a class="embedly-card" data-card-key="ee29ed4b275e459483a608ca67084559" data-card-controls="0" href="https://speakerdeck.com/puhitaku/concurrency-for-distributed-web-crawlers">Concurrency for distributed Web crawlers</a><br />
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script></p>

<p>(↑のカードをクリックでスライドに飛びます。)</p>

<h2 id="appstore-と-google-play-をクロールして欲しい情報を収集するやつ">AppStore と Google Play をクロールして欲しい情報を収集するやつ</h2>

<ul>
<li><p>クロール対象はシングルドメイン。だが対象となるアプリが多い (100k以上) 。</p>

<ul>
<li>同一IPからあんまりひどいことするとバンされたりする&hellip;。<br /></li>
<li>とはいえあんまりちんたらやってるわけにもいかない。24時間以内にクロールし終わる必要がある。<br />
<br /></li>
</ul></li>

<li><p>Commander と Crawler</p>

<ul>
<li>AWS EC2 Container Service を使っている。<br /></li>
<li>一日30弱くらいのインスタンスを立ち上げて並列でクローリングする。<br />
<br /></li>
</ul></li>

<li><p>1 アプリあたりのクロール時間が見積もれないと困る。</p>

<ul>
<li>1 アプリあたりのクロール速度は割とまちまち。終わるの待ってたらクロール量が安定しない。<br /></li>
<li>一個あたりのクロールを goroutine で行う。<br /></li>
<li>規定時間を設ける。規定時間より超過した場合、終わってなくても次のタスクをスタートさせる。<br /></li>
<li>という戦略で、時間あたりのクロール数を見積もれるという寸法。<br />
<br /></li>
</ul></li>

<li><p>落とし穴シリーズ</p>

<ul>
<li>TCPコネクションを使い果たす問題。並列に行われるクロールの数が多すぎると TCP コネクションを使い果たしてしまう…。<br /></li>
<li>この問題は、make(chan int, 100) みたくして、Channel が保持する値の数を制限することで対応。<br />
<br /></li>
</ul></li>
</ul>

<hr />

<h1 id="goのスケジューラー実装とハマりポイント-by-niconegoto-さん">Goのスケジューラー実装とハマりポイント by niconegoto さん</h1>

<p><a class="embedly-card" data-card-key="ee29ed4b275e459483a608ca67084559" data-card-controls="0" data-card-type="article-full" href="https://talks.godoc.org/github.com/niconegoto/talks/concurrency.slide#1">Goのスケジューラー実装とハマりポイント</a><br />
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script></p>

<p>Goroutine の内部実装について。</p>

<h2 id="goroutine-の実装デザイン">Goroutine の実装デザイン</h2>

<ul>
<li>runtime を読む。<br /></li>

<li><p><a href="https://golang.org/pkg/runtime">https://golang.org/pkg/runtime</a></p></li>

<li><p>M、G、P という文字が頻繁に出てくる。それらの意味は、</p>

<ul>
<li>M &hellip; Machine<br /></li>
<li>G &hellip; Goroutine<br /></li>
<li>P &hellip; Processor<br />
<br /></li>
</ul></li>
</ul>

<h2 id="スケジューラーのハマりどころ">スケジューラーのハマりどころ</h2>

<ul>
<li>C 言語の pthread なんかと同じで、goroutine もコンテキストスイッチを考慮する必要がある。<br /></li>
<li><a href="https://morsmachine.dk/go-scheduler">Morsing&rsquo;s Blog</a> に詳しいこと書いてある。<br />
<br /></li>
</ul>

<h1 id="ridge-a-framework-like-gae-go-on-aws-by-fujiwara-さん">Ridge a framework like GAE/Go on AWS by fujiwara さん</h1>

<p><a class="embedly-card" data-card-key="ee29ed4b275e459483a608ca67084559" data-card-controls="0" href="https://speakerdeck.com/fujiwara3/go-on-aws">Ridge - A framework like GAE/Go on AWS</a><br />
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script></p>

<p>Go で書いた HTTP Server を AWS Lambda で動かす…！</p>

<h2 id="ridge-の紹介">Ridge の紹介</h2>

<ul>
<li><a href="https://github.com/fujiwara/ridge">Ridge</a><br /></li>
<li>実質、GAE/Go みたいなことを AWS Lambda で実現できる<br /></li>
<li>裏で goroutine を延々動かしておくみたいなことはできない。Lambda はレスポンス返し終わると寝てしまう。<br />

<ul>
<li>次のリクエストが来たら起きて続きの処理が行われていく<br /></li>
</ul></li>

<li><p>頻繁にアクセスがなく、レイテンシ要求がシビアでないようなものに向く</p>

<ul>
<li>サービスが終了したゲームの告知 API とか。POST を受けて JSON を返す、という処理を EC2 使わないで行う。<br />
<br /></li>
</ul></li>

<li><p>EC2 使わず、それでいてリクエスト数が多ければスケールする、ということで用途が合えば非常にリーズナブルにできる印象。</p></li>
</ul>

<hr />

<h1 id="ライブコーディング-by-kaneshin-さん">ライブコーディング by kaneshin さん</h1>

<p><img src="/images/golang.tokyo-4/1.jpg" alt="golang.tokyo-4" /><br />
写真1. ライブコーディング直前の kaneshin さん</p>

<ul>
<li>tail コマンドを作る&hellip;!<br /></li>
<li><a href="https://gist.github.com/kaneshin/a398720b8e20722a83bc6903e4017435">完成したものはこちら</a><br />
<br /></li>
</ul>

<h2 id="ポイント-と思ったところ">ポイント (と思ったところ)</h2>

<ul>
<li>kaneshin さんは vim + vim-go プラグインを使って Go を書いている模様。<br /></li>
<li>channel をバッファのように扱っている。<br /></li>
<li>入力を待ち受ける goroutine と、出力を担当する goroutine とで 2 並列。<br />
今回のテーマにあった良い題材であると感じた。<br />
<br /></li>
</ul>

<hr />

<h1 id="嫁に怒られずに-go-を書く技術-by-teitei-tk">嫁に怒られずに Go を書く技術 by teitei_tk</h1>

<p><a class="embedly-card" data-card-key="ee29ed4b275e459483a608ca67084559" data-card-controls="0" href="https://speakerdeck.com/teitei/jia-ninu-rarezunigowoshu-kuji-shu">嫁に怒られずにGoを書く技術</a><br />
<script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script></p>

<p>「嫁のため」という免罪符を得て開発していくスタイル</p>

<ul>
<li>LINE に天気予報だったりを投稿する。<br /></li>
<li>つまり生活に役立つというか家内に益があれば良いということ。<br /></li>
<li>夫婦円満を願ってやまない。<br />
<br /></li>
</ul>

<hr />

<h1 id="gogland-by-sergey-ignatov-さん">Gogland by Sergey Ignatov さん</h1>

<p><img src="/images/golang.tokyo-4/2.jpg" alt="golang.tokyo-4" /><br />
写真2. Gogland の開発者 Sergey Ignatov さん</p>

<p>JetBrains から Sergey Ignatov さんが来てくれて、Gogland の紹介をしてくれたぞ！</p>

<ul>
<li>function の定義に飛んで実装を確認する必要はなく、小窓で出せるような機能がある。便利そう。<br /></li>
<li>引数のサジェストが賢い。ファジーサーチ的に動きつつ、型が合わないものはサジェストされない、等。<br /></li>
<li>保存時に go fmt、 go import する機能も最近対応された。<br /></li>
<li>2017年3月現在は EAP 版だが、年末くらいには EAP が取れて正式版になるような予定らしい。<br /></li>
<li>意見・要望があったら <a href="https://youtrack.jetbrains.com/issues/GO">issue tracker</a> へ！<br />
<br /></li>
</ul>

<hr />

<p>ざっくりですが、かいつまんで golang.tokyo 4 回目の様子を紹介いたしました。<br />
休憩時間にはビールも振る舞われたりして、無料でいいんですかという気持ちになります。<br />
いつもありがとうございます。</p>

<p>次回もまた 4 月くらいに実施されるようなので、都合が合えば参加させていただこうかと思います。</p>

                    </div>
                    
                    <div class="post-share">
                        <div class="post-share-links">
                            <h4 style="">Share</h4>
                            
                            
                            
                            <a href="#" data-type="twitter" data-url="https://pankona.github.io/blog/2017/03/01/golangtokyo-4/" data-description="" data-via="" class="prettySocial fa fa-twitter"></a>
                            
                            
                        </div>
                    </div>
                    
                    
                </section>
            </div>
            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li>Powered by <a class="hugo" href="https://gohugo.io/" target="_blank">hugo</a></li>
        </ul>
    </div>
</div>
<script src="https://pankona.github.io/js/all.min.js"></script>

        </div>
    </div>
</div>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', '', 'auto');
ga('send', 'pageview');

</script>

</body>
</html>
